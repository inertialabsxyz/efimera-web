---
export const prerender = false;

import Layout from "../../layouts/Layout.astro";
import ArticleCard from "../../components/ArticleCard.astro";
import Pagination from "../../components/Pagination.astro";
import {
    getArticlesByCategoryPaginated,
    getArticlesPaginated,
    urlFor,
} from "../../lib/sanity";

const { category } = Astro.params;
const categoryTitle = category
    ? category.charAt(0).toUpperCase() + category.slice(1)
    : "";

// "Todos" means "All" in Spanish - show all articles
const isAll = category?.toLowerCase() === "todos";

const pageParam = Astro.url.searchParams.get("page");
const currentPage = Math.max(1, parseInt(pageParam || "1", 10) || 1);

const { articles, totalPages } = isAll
    ? await getArticlesPaginated(currentPage, 10)
    : await getArticlesByCategoryPaginated(categoryTitle, currentPage, 10);

// Demo articles filtered by category
// const allArticles = [
//     {
//         _id: "1",
//         title: "The Architecture of Silence",
//         slug: { current: "architecture-of-silence" },
//         category: "Art",
//     },
//     {
//         _id: "2",
//         title: "Backstage at Maison Margiela",
//         slug: { current: "maison-margiela" },
//         category: "Fashion",
//     },
//     {
//         _id: "3",
//         title: "Berlin After Dark",
//         slug: { current: "berlin-after-dark" },
//         category: "Night",
//     },
//     {
//         _id: "4",
//         title: "In Conversation with Ryuichi Sakamoto",
//         slug: { current: "ryuichi-sakamoto" },
//         category: "Music",
//     },
//     {
//         _id: "5",
//         title: "The Wabi-Sabi of Oaxacan Ceramics",
//         slug: { current: "oaxacan-ceramics" },
//         category: "Travel",
//     },
//     {
//         _id: "6",
//         title: "Notes from the Venice Biennale",
//         slug: { current: "venice-biennale" },
//         category: "Diary",
//     },
//     {
//         _id: "7",
//         title: "The Return of Analog Photography",
//         slug: { current: "analog-photography" },
//         category: "Art",
//     },
// ];

// const articles = allArticles.filter(
//     (a) => a.category.toLowerCase() === category,
// );
const categories = [
    "Todos",
    "Actividades",
    "Artistas",
    "Exposiciones",
    "Letras",
    "Música",
    "Revista",
];
---

<Layout title={`${categoryTitle} — Revista`}>
    {
        articles.length > 0 ? (
            <>
                <div class="article-grid">
                    {articles.map((article, index) => (
                        <ArticleCard
                            title={article.title}
                            slug={article.slug.current}
                            category={article.category}
                            image={
                                article.mainImage
                                    ? urlFor(article.mainImage)
                                          .width(800)
                                          .height(600)
                                          .url()
                                    : undefined
                            }
                            excerpt={article.excerpt}
                        />
                    ))}
                </div>
                <Pagination
                    currentPage={currentPage}
                    totalPages={totalPages}
                    baseUrl={`/category/${category}`}
                />
            </>
        ) : (
            <div class="empty-state">
                <p>Aún no hay artículos en esta categoría.</p>
            </div>
        )
    }
</Layout>

<style>
    .empty-state {
        text-align: center;
        padding: 8rem 2rem;
        color: var(--color-text-muted);
    }
</style>
